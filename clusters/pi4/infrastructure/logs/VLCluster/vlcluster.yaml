apiVersion: operator.victoriametrics.com/v1
kind: VLCluster
metadata:
  name: dev-logs
  namespace: vm
  labels:
    app.kubernetes.io/name: vlcluster
    app.kubernetes.io/instance: dev-logs
spec:
  # Версія кластеру VictoriaLogs
  clusterVersion: v1.36.1
  
  # Конфігурація vlstorage (аналог vmstorage)
  vlstorage:
    replicaCount: 0
    retentionPeriod: "7d"
    storageDataPath: "/vl-data"
    
    storage:
      volumeClaimTemplate:
        spec:
          resources:
            requests:
              storage: "10Gi"
          # storageClassName: "fast-ssd"
    
    resources:
      requests:
        cpu: 200m
        memory: 500Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    
    nodeSelector:
      kubernetes.io/hostname: server

    # Додаткові аргументи для vlstorage
    extraArgs:
      # Оптимізація для обробки великих обсягів логів
      memory.allowedPercent: "80"

  # Конфігурація vlselect (аналог vmselect)
  vlselect:
    replicaCount: 0

    resources:
      requests:
        cpu: 100m
        memory: 200Mi
      limits:
        cpu: 500m
        memory: 1Gi

    nodeSelector:
      kubernetes.io/hostname: server

    # Додаткові аргументи для vlselect
    extraArgs:
      # Увімкнення VLUI
      http.disableResponseCompression: "false"
      # Збільшення таймауту для складних запитів
      search.maxQueryDuration: "10m"

  # Конфігурація vlinsert (аналог vminsert)
  vlinsert:
    replicaCount: 0

    resources:
      requests:
        cpu: 100m
        memory: 200Mi
      limits:
        cpu: 500m
        memory: 512Mi

    nodeSelector:
      kubernetes.io/hostname: server

    # Додаткові аргументи для vlinsert
    extraArgs:
      # Максимальний розмір лог повідомлення
      insert.maxFieldsPerLine: "1000"
      # Максимальний розмір одного лог запису
      insert.maxLineSizeBytes: "16384"
      # Оптимізація для обробки JSON логів
      loggerFormat: "json"
